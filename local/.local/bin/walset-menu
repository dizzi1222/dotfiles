#!/bin/bash

# Directorio que contiene los fondos de pantalla
WALL_DIR="$HOME/wallpapers/wallpapers/"

# El script se ejecuta desde la ubicaci√≥n del fondo
cd "$WALL_DIR" || exit

# Obt√©n la imagen seleccionada del men√∫ de Rofi
SELECTED_WALL=$(for a in *.jpg *.png *.gif *.webp; do echo -en "$a\0icon\x1f$a\n"; done | rofi -dmenu -p "ÔÄÇ " -theme ~/.config/rofi/config-wallpaper.rasi)

# Si se seleccion√≥ una imagen, ejecuta el proceso de cambio
if [ -n "$SELECTED_WALL" ]; then

  # Notificaci√≥n inicial
  notify-send "üé® Changing Theme" "Applying new wallpaper and updating colors..."

  # 1. Cambiar el fondo con swww
  swww img "$SELECTED_WALL" --transition-type='center' --transition-fps="60" --transition-step=1

  # 2. Generar la paleta de colores con Pywal
  wal -i "$SELECTED_WALL"

  # 3. Peque√±o retraso para que Waybar pueda leer los nuevos colores
  sleep 0.2

  # 4. Reiniciar Waybar para aplicar la nueva paleta
  pkill waybar
  sleep 0.2                           # Dale un respiro al sistema
  waybar -c ~/.config/waybar/config & # Le especificas la configuraci√≥n
  # Notificaci√≥n final
  notify-send "‚úÖ Wallpaper aplicado" "Colores y temas actualizados correctamente"
fi
